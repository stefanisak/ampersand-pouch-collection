// Generated by CoffeeScript 1.9.0
(function() {
  var AmpersandCollection, sync, _;

  AmpersandCollection = require('ampersand-collection');

  _ = require('underscore');

  sync = require('ampersand-pouch-sync');

  module.exports = AmpersandCollection.extend({
    initialize: function() {
      return this.sync = sync.apply(this, [this.pouch]);
    },
    fetch: function(options) {
      var me, success;
      options = options || {};
      if (options.parse == null) {
        options.parse = true;
      }
      success = options.success;
      me = this;
      options.success = function(response) {
        var method;
        if (options.reset) {
          method = 'reset';
        } else {
          method = 'set';
        }
        me[method](response, options);
        if (success) {
          success(me, response, options);
        }
        return me.trigger('sync', me, response, options);
      };
      return this.sync('read', this, options);
    },
    create: function(model, options) {
      var collection, success;
      options = options || {};
      if (!(model = this._prepareModel(model, options))) {
        return false;
      }
      collection = this;
      success = options.success;
      options.success = function(model, resp) {
        collection.add(model, options);
        if (success) {
          return success(model, resp, options);
        }
      };
      model.save(null, options);
      return model;
    },
    sync: function() {
      return sync.apply(this, arguments);
    },
    getOrFetch: function(id, options, cb) {
      return console.log('getOrFetch');
    },
    fetchById: function(id, cb) {
      return console.log('fetchById');
    },
    parse: function(result) {
      return _.pluck(result.rows, 'doc');
    }
  });

}).call(this);
